---
title: "TMP"
summary: "TMP"
date: 2025-08-14
draft: false
weight: 1
---

<div>
    <h1>Доставки</h1>
    <div id="deliveries-legend-container"></div>
    <canvas id="deliveriesChart"></canvas>
    <h1>Ожиріння</h1>
    <h2>Вага</h2>
    <div id="weight-legend-container"></div>
    <canvas id="weightChart"></canvas>
    <h2>Пробіжки</h2>
    <div id="runs-legend-container"></div>
    <canvas id="runsChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- deliveries chart -->
<script>
    const successDayColor = 'rgba(85, 255, 79, 0.55)';
    const failedDayColor = 'rgba(255, 0, 0, 0.61)';
    fetch('/deliveries.json').
        then(resp => resp.json()).
        then(data => {
            const ctx = document.getElementById('deliveriesChart');

            const colors = [];
            Object.values(data).forEach(isSuccessDay => {
                if (isSuccessDay) {
                    colors.push(successDayColor);
                } else {
                    colors.push(failedDayColor);
                }
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        data: new Array(Object.keys(data).length).fill(1),
                        backgroundColor: colors,
                    }]
                },
                options: {
                    scales: {
                        y: {
                            display: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            displayColors: false,
                            callbacks: {
                                label: deliveriesTooltipCallback,
                            }
                        }
                    },
                    htmlLegend: {
                        containerID: 'deliveries-legend-container'
                    }
                },
                plugins: [{
                    id: 'htmlLegend',
                    afterUpdate(chart, args, options) {
                        const container = document.getElementById('deliveries-legend-container');
                        var dataset = chart.data.datasets[0].backgroundColor;
                        var [successes, fails] = calcSuccessAndFailsDaysOfDeliveries(dataset, dataset.length - 1);

                        container.innerHTML = `<p>
                        <div>Днів без доставок: ${successes}</div>
                        <div>Днів з доставками: ${fails}</div>
                        </p>`;
                    }
                }]
            });
        });

    function calcSuccessAndFailsDaysOfDeliveries(colors, index) {
        var successes = 0;
        var fails = 0;
        for (var i = 0; i <= index; i++) {
            switch (colors[i]) {
                case successDayColor:
                    successes++;
                    break;
                case failedDayColor:
                    fails++;
                    break;
            }
        }

        return [successes, fails]
    }
    function deliveriesTooltipCallback(context) {
        const index = context.dataIndex;

        var [successes, fails] = calcSuccessAndFailsDaysOfDeliveries(context.dataset.backgroundColor, index);

        var dayDesc = "";
        switch (context.dataset.backgroundColor[context.dataIndex]) {
            case successDayColor:
                dayDesc = "День без доставок :)";
                break;
            case failedDayColor:
                dayDesc = "День з доставкою :(";
                break;
        }

        return [
            dayDesc,
            `Днів без доставок: ${successes}`,
            `Доставок: ${fails}`
        ]
    }
</script>

<!-- weight chart -->
<script>
    fetch('/weight.json').
        then(resp => resp.json()).
        then(data => {
            const ctx = document.getElementById('weightChart');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'Kgs',
                        data: Object.values(data),
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            min: 60.0
                        }
                    },
                    plugins: {
                        legend: {
                            display: false,
                        }
                    },
                    htmlLegend: {
                        containerID: 'weight-legend-container'
                    }
                },
                plugins: [{
                    id: 'htmlLegend',
                    afterUpdate(chart, args, options) {
                        const container = document.getElementById('weight-legend-container');
                        var dataset = chart.data.datasets[0].data;
                        var lastIndex = dataset.length - 1;

                        container.innerHTML = `<p>
                        <div>Початкова вага: ${dataset[0]}</div>
                        <div>Поточна вага: ${dataset[lastIndex]}</div>
                        <!-- 
                            <div>Зміна за останні 7 днів: ${dataset[lastIndex - 7] - dataset[lastIndex]}</div>
                            <div>Зміна за останній місяць: ${dataset[lastIndex - 28] - dataset[lastIndex]}</div>
                        -->
                        </p>`;
                    }
                }]
            });
        });
</script>

<!-- runs chart -->
<script>
    const runColor = 'rgba(85, 255, 79, 0.55)';
    const freeColor = 'rgba(197, 197, 197, 0.55)';
    const missedColor = 'rgba(255, 0, 0, 0.61)';

    fetch('/runs.json').
        then(resp => resp.json()).
        then(data => {
            const ctx = document.getElementById('runsChart');

            const colors = [];
            Object.values(data).forEach(type => {
                switch (type) {
                    case "run":
                        colors.push(runColor)
                        break;
                    case "free":
                        colors.push(freeColor)
                        break;
                    case "missed":
                        colors.push(missedColor)
                        break;
                    default:
                        console.error("unknown day type: " + day.type)
                }
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        data: new Array(Object.keys(data).length).fill(1),
                        backgroundColor: colors,
                    }]
                },
                options: {
                    scales: {
                        y: {
                            display: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            displayColors: false,
                            callbacks: {
                                label: runsTooltipCallback,
                            }
                        }
                    },
                    htmlLegend: {
                        containerID: 'runs-legend-container'
                    }
                },
                plugins: [{
                    id: 'htmlLegend',
                    afterUpdate(chart, args, options) {
                        const container = document.getElementById('runs-legend-container');
                        var dataset = chart.data.datasets[0].backgroundColor;
                        var [successes, fails] = calcSuccessAndFailsDaysOfRuns(dataset, dataset.length - 1);

                        container.innerHTML = `<p>
                        <div>Пробіжок: ${successes}</div>
                        <div>Пропущених пробіжок: ${fails}</div>
                        </p>`;
                    }
                }]
            });
        });

    function calcSuccessAndFailsDaysOfRuns(colors, index) {
        var successes = 0;
        var fails = 0;
        for (var i = 0; i <= index; i++) {
            switch (colors[i]) {
                case runColor:
                    successes++;
                    break;
                case missedColor:
                    fails++;
                    break;
            }
        }

        return [successes, fails]
    }

    function runsTooltipCallback(context) {
        const index = context.dataIndex;

        var runs = 0;
        var fails = 0;
        for (var i = 0; i <= index; i++) {
            switch (context.dataset.backgroundColor[i]) {
                case runColor:
                    runs++;
                    break;
                case missedColor:
                    fails++;
                    break;
            }
        }

        var dayDesc = "";
        switch (context.dataset.backgroundColor[index]) {
            case runColor:
                dayDesc = "День з пробіжкою :)";
                break;
            case freeColor:
                dayDesc = "Вільний день :|";
                break;
            case missedColor:
                dayDesc = "Пропущений день :(";
                break;
        }

        return [
            dayDesc,
            `Пробіжок: ${runs}`,
            `Провалів: ${fails}`
        ]
    }
</script>